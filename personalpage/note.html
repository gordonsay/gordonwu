<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GJ | Note</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style_personal.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../icon/favicon-16x16.png">
    <link rel="manifest" href="../icon/site.webmanifest">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body {
            background-color: rgba(0, 105, 148, 0.7); /* 海洋藍色，透明度為 0.7 */
        }
        .content-wrapper {
            background-color: rgba(0, 0, 0, 0.6); /* 黑色背景，透明度為 0.6 */
            min-height: 100vh;
            padding-top: 60px; /* 為固定導航欄留出空間 */
        }
        #map {
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
            z-index: 1; /* 確保地圖在導航欄下方 */
        }
        #locationInput {
            width: 100%;
            margin-bottom: 10px;
        }
        .review-list {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .review-item {
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        .review-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .navbar {
            background-color: rgba(0, 0, 0, 0.7); /* 確保導航欄背景一致 */
            z-index: 1000; /* 確保導航欄在最上層 */
        }
        #flagSelection {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .flag-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .flag-item img {
            width: 54px;
            height: 48px;
            margin-right: 10px;
        }
        .flag-item span {
            color: white;
        }
        .review-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .review-header img {
            width: 36px;
            height: 32px;
            margin-right: 10px;
        }
        .review-header h3 {
            margin: 0;
        }
        .leaflet-top {
            top: 60px; /* 為固定導航欄留出空間 */
        }
        .emoji-selector {
            display: flex;
            margin-bottom: 10px;
        }
        .emoji-selector span {
            font-size: 24px;
            margin-right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-lg-3">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="index_personal.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="eat.html">Eat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white "  href="travel.html">Travel</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="box.html">Video</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="gameplay.html">Game</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white active"  aria-current="page" href="#">Note</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="gift.html">Gift</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

<div class="content-wrapper">
  <div class="container">
    <h1 class="mt-5 text-white">Note</h1>
    <input id="noteTitle" type="text" class="form-control mb-2" placeholder="title">
    <div class="emoji-selector">
        <span onclick="addEmoji('😊')">😊</span>
        <span onclick="addEmoji('😂')">😂</span>
        <span onclick="addEmoji('😍')">😍</span>
        <span onclick="addEmoji('🤔')">🤔</span>
        <span onclick="addEmoji('👍')">👍</span>
    </div>
    <textarea id="noteContent" class="form-control mb-2" rows="4" placeholder="contents"></textarea>
    <button onclick="submitNote()" class="btn btn-primary">submit</button>
    <div class="review-list mt-4">
      <h2 class="text-white">List</h2>
      <div id="noteList" class="text-white"></div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
// Firebase 配置
const firebaseConfig = {
    apiKey: "AIzaSyAy3wt6h_7zLz946XmAZIFFJAFPCkWUCLk",
    authDomain: "test-c338f.firebaseapp.com",
    projectId: "test-c338f",
    storageBucket: "test-c338f.appspot.com",
    messagingSenderId: "117988025801",
    appId: "1:117988025801:web:e95e3c918b8fb9c0e63418",
    measurementId: "G-VYK0LHZ950"
};

// 初始化 Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

function addEmoji(emoji) {
    const noteContent = document.getElementById('noteContent');
    noteContent.value += emoji;
}

function submitNote() {
    const title = document.getElementById('noteTitle').value;
    const content = document.getElementById('noteContent').value;
    if (!title || !content) {
        alert('請輸入標題和內容');
        return;
    }

    const note = {
        title,
        content,
        timestamp: Date.now()
    };

    database.ref('notes').push(note)
        .then(() => {
            renderNotes();
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
        })
        .catch(error => console.error("Error adding note: ", error));
}

function renderNotes() {
    const noteList = document.getElementById('noteList');
    noteList.innerHTML = '';

    database.ref('notes').once('value')
        .then(snapshot => {
            snapshot.forEach(childSnapshot => {
                const note = childSnapshot.val();
                const noteElement = document.createElement('div');
                noteElement.className = 'review-item mb-3';
                noteElement.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="note-title">${note.title}</h3>
                        <div>
                            <button class="btn btn-primary btn-sm me-2" onclick="editNote('${childSnapshot.key}')">編輯</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteNote('${childSnapshot.key}')">刪除</button>
                        </div>
                    </div>
                    <p class="note-content">${note.content}</p>
                    <small class="text-muted">${new Date(note.timestamp).toLocaleString()}</small>
                    <div class="edit-form" style="display: none;">
                        <input type="text" class="form-control mb-2 edit-title" value="${note.title}">
                        <textarea class="form-control mb-2 edit-content" rows="4">${note.content}</textarea>
                        <button class="btn btn-success btn-sm" onclick="saveNote('${childSnapshot.key}')">儲存</button>
                        <button class="btn btn-secondary btn-sm" onclick="cancelEdit('${childSnapshot.key}')">取消</button>
                    </div>
                    <hr>
                `;
                noteList.appendChild(noteElement);
            });
        })
        .catch(error => console.error("Error fetching notes: ", error));
}

function editNote(id) {
    const noteElement = document.querySelector(`[onclick="editNote('${id}')"]`).closest('.review-item');
    noteElement.querySelector('.note-title').style.display = 'none';
    noteElement.querySelector('.note-content').style.display = 'none';
    noteElement.querySelector('.edit-form').style.display = 'block';
}

function cancelEdit(id) {
    const noteElement = document.querySelector(`[onclick="editNote('${id}')"]`).closest('.review-item');
    noteElement.querySelector('.note-title').style.display = 'block';
    noteElement.querySelector('.note-content').style.display = 'block';
    noteElement.querySelector('.edit-form').style.display = 'none';
}

function saveNote(id) {
    const noteElement = document.querySelector(`[onclick="editNote('${id}')"]`).closest('.review-item');
    const newTitle = noteElement.querySelector('.edit-title').value;
    const newContent = noteElement.querySelector('.edit-content').value;

    if (!newTitle || !newContent) {
        alert('請輸入標題和內容');
        return;
    }

    database.ref('notes').child(id).update({
        title: newTitle,
        content: newContent,
        timestamp: Date.now()
    })
    .then(() => {
        renderNotes();
    })
    .catch(error => console.error("Error updating note: ", error));
}

document.addEventListener('DOMContentLoaded', renderNotes);
</script>

<!-- 添加這行 Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
